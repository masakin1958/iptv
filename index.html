// 再生処理の部分を以下に差し替え（エラー表示機能付き）
function playStream(url, name) {
    loadingText.style.display = 'block';
    loadingText.innerText = name + ' を読み込み中...';
    
    // 以前の再生を停止
    video.pause();
    video.src = "";
    video.load();

    if (Hls.isSupported()) {
        hls.destroy(); // 一旦リセット
        const newHls = new Hls({
            enableWorker: true,
            lowLatencyMode: true,
        });
        newHls.loadSource(url);
        newHls.attachMedia(video);
        newHls.on(Hls.Events.MANIFEST_PARSED, () => {
            video.play().catch(e => {
                loadingText.innerText = "再生エラー: ブラウザの再生ボタンを押してください";
            });
            loadingText.style.display = 'none';
        });
        newHls.on(Hls.Events.ERROR, (event, data) => {
            if (data.fatal) {
                loadingText.innerText = "エラー: この配信源は現在利用できないようです";
                console.error("HLS Error:", data);
            }
        });
    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        // iPhoneなどのSafari用
        video.src = url;
        video.addEventListener('loadedmetadata', () => {
            video.play();
            loadingText.style.display = 'none';
        });
    }
}

