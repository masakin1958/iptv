<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strong IPTV Player</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body { margin: 0; font-family: sans-serif; background: #000; color: #fff; display: flex; flex-direction: column; height: 100vh; }
        header { background: #222; padding: 10px; text-align: center; font-size: 1rem; }
        .video-box { flex: 1; display: flex; align-items: center; justify-content: center; background: #000; }
        video { width: 100%; height: 100%; max-height: 50vh; }
        .list-box { height: 50vh; overflow-y: auto; background: #111; padding: 5px; }
        .channel-item { padding: 15px; border-bottom: 1px solid #333; cursor: pointer; font-size: 1.1rem; }
        .channel-item:active { background: #444; }
        #msg { position: absolute; top: 60px; width: 100%; text-align: center; background: rgba(0,0,0,0.5); font-size: 0.8rem; pointer-events: none; }
    </style>
</head>
<body>

<header>My TV Player</header>
<div id="msg">読み込み中...</div>

<div class="video-box">
    <video id="video" controls playsinline autoplay></video>
</div>

<div class="list-box" id="list"></div>

<script>
    const video = document.getElementById('video');
    const msg = document.getElementById('msg');
    const listDiv = document.getElementById('list');
    const hls = new Hls();

    async function start() {
        try {
            // channels.json を取得
            const res = await fetch('channels.json?t=' + Date.now());
            const data = await res.json();
            
            Object.keys(data).forEach(name => {
                const div = document.createElement('div');
                div.className = 'channel-item';
                div.innerText = name;
                div.onclick = () => {
                    const url = data[name][0]; // ひとまず1番目のURLを再生
                    play(url, name);
                };
                listDiv.appendChild(div);
            });
            msg.innerText = "チャンネルを選んでください";
        } catch (e) {
            msg.innerText = "エラー: 読み込めませんでした";
        }
    }

    function play(url, name) {
        msg.innerText = name + " を再生中...";
        
        if (Hls.isSupported()) {
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = url;
            video.play();
        }
    }

    start();
</script>
</body>
</html>
