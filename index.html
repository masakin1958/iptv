<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>My Premium TV</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body { margin:0; background:#121212; color:#fff; font-family:sans-serif; display:flex; flex-direction:column; height:100vh; }
        .video-box { flex:none; height:40vh; background:#000; position:sticky; top:0; z-index:100; }
        video { width:100%; height:100%; }
        .list { flex:1; overflow-y:auto; padding:10px; }
        .item { padding:15px; border-bottom:1px solid #333; cursor:pointer; display:flex; justify-content:space-between; }
        .item.priority { border-left: 5px solid #ff4500; background: #2a2a2a; font-weight: bold; }
        .item:active { background: #444; }
        #status { padding:5px; font-size:12px; text-align:center; color:#888; }
    </style>
</head>
<body>
    <div class="video-box"><video id="video" controls autoplay playsinline></video></div>
    <div id="status">読込中...</div>
    <div class="list" id="list"></div>

    <script>
        const video = document.getElementById('video');
        const listDiv = document.getElementById('list');
        const status = document.getElementById('status');
        const hls = new Hls();

        // 優先的に上に表示したいキーワード
        const PRIORITY = ["NHK", "日本テレビ", "テレビ朝日", "TBS", "テレビ東京", "フジテレビ", "TOKYO MX"];

        async function init() {
            try {
                // iptv-orgの日本リストを取得
                const res = await fetch('https://iptv-org.github.io/iptv/countries/jp.m3u');
                const text = await res.text();
                const lines = text.split('\n');
                
                let channels = [];
                for (let i = 0; i < lines.length; i++) {
                    if (lines[i].startsWith('#EXTINF:')) {
                        const name = lines[i].split(',').pop().trim();
                        const url = lines[i+1]?.trim();
                        if (url && url.startsWith('http')) {
                            channels.push({ name, url });
                        }
                    }
                }

                // 並び替え：優先キーワードが含まれるものを上に
                channels.sort((a, b) => {
                    const aPrio = PRIORITY.some(p => a.name.includes(p)) ? 0 : 1;
                    const bPrio = PRIORITY.some(p => b.name.includes(p)) ? 0 : 1;
                    return aPrio - bPrio;
                });

                channels.forEach(ch => {
                    const div = document.createElement('div');
                    const isPrio = PRIORITY.some(p => ch.name.includes(p));
                    div.className = 'item' + (isPrio ? ' priority' : '');
                    div.innerHTML = `<span>${ch.name}</span><span>${isPrio ? '★' : ''}</span>`;
                    div.onclick = () => {
                        status.innerText = ch.name + " を再生中...";
                        if (Hls.isSupported()) {
                            hls.loadSource(ch.url);
                            hls.attachMedia(video);
                        } else { video.src = ch.url; }
                    };
                    listDiv.appendChild(div);
                });
                status.innerText = "読込完了";
            } catch (e) { status.innerText = "エラー"; }
        }
        init();
    </script>
</body>
</html>
